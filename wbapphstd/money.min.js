// Create Element and render expenses
function allCommands(){
	

const expnsList=document.getElementById('expense-list');

function renderExpense(doc){
	let expnsList=document.getElementById('expense-list');
	let li= document.createElement('LI');
	li.setAttribute("class","li_frm");
	let name=document.createElement('SPAN');
	name.setAttribute("class", "name_class");
	let money=document.createElement('SPAN');
	money.setAttribute("class","money_class");
	let hours = document.createElement('SPAN');
	hours.setAttribute("class","dates_class");
	let cross= document.createElement('div');
	cross.setAttribute("class","cross_class");

	li.setAttribute('data-id', doc.id);

	name.textContent=doc.data().name;
	money.textContent=doc.data().cost;
	let hourz =doc.data().hour;
	let minutez =doc.data().minute;
	let dayz =doc.data().day;
	let yearz =doc.data().year;
	let monthz =doc.data().month;
	hours.textContent = dayz + " " + monthz + " " + yearz + " at " + hourz + ":" + minutez;
	cross.innerHTML = "&#x2716;" ;

	expnsList.appendChild(li);
	li.appendChild(name);
	li.appendChild(money);
	li.appendChild(hours);
	li.appendChild(cross);
	
	
		
//Delete a document

cross.addEventListener('click',(e)=>{
	$("body").css("opacity","0.6");
	e.stopPropagation();
	let id=e.target.parentElement.getAttribute('data-id');
	db.collection('Accounts')
	.doc($(".usrsfld").val().toString())
	.collection('intru-money')
	.doc(id)
	.delete()
	.then(function() {
	e.target.parentElement.remove();
		var sum = 0;
    	$('.money_class:not(:hidden)').each(function() {
	    sum += +$(this).text()||0;
    	});
	    $(".sum_exp").text(sum);
	    $("body").css("opacity","1");
	})
})
}


//Listen for Realtime Updates
function checkforrltm(){
db.collection("Accounts")
.doc($(".usrsfld").val().toString())
.collection('intru-money')
    .onSnapshot(function(snapshot) {
        snapshot.docChanges().forEach(function(change) {
            if(change.type == "added"){
db.collection('Accounts')
.doc($(".usrsfld").val().toString())
.collection('intru-money')
.orderBy('date')
.get()
.then(function(querySnapshot) {
    querySnapshot.forEach(function(doc) {
        // doc.data() is never undefined for query doc snapshots
        renderExpense(doc);
        $(".li_frm").hide();
	    var mnthsslct = $(".mnth_slct").children("option:selected").text();
	    $("span:contains('" + mnthsslct + "')").parent().show();
})
})
}
console.log('Successfully updated');
          });
    }); 

}
//Display data in page

db.collection('Accounts')
.doc($(".usrsfld").val().toString())
.collection('intru-money')
.orderBy('date')
.get()
.then(function(querySnapshot) {
    querySnapshot.forEach(function(doc) {
        // doc.data() is never undefined for query doc snapshots
		renderExpense(doc);
		$(".li_frm").hide();
	    var mnthsslct = $(".mnth_slct").children("option:selected").text();
	    $("span:contains('" + mnthsslct + "')").parent().show( function(){
    	var sum = 0;
    	$('.money_class:not(:hidden)').each(function() {
    	sum += +$(this).text()||0;
    	$(".sum_exp").text(sum);
    	});
    	}); 


})
})

// Show data according to month
		$(".mnth").click( function(){
		$("body").css("opacity","0.4 !important")
		$(".pnl-div").css("left","-1700px")
		$("#expense-list").empty();
		$(".sum_exp").text("0");
		var mnthsslt = $(".mnth_slct").children("option:selected").text();
		
db.collection('Accounts')
.doc($(".usrsfld").val().toString())
.collection('intru-money')
.orderBy('date')
.get()
.then(function(querySnapshot) {
    querySnapshot.forEach(function(doc) {
        // doc.data() is never undefined for query doc snapshots
		renderExpense(doc);
		$(".li_frm").hide();
	    $("span:contains('" + mnthsslt + "')").parent().show( function(){
    	var sum = 0;
    	$('.money_class:not(:hidden)').each(function() {
    	sum += +$(this).text()||0;
    	$(".sum_exp").text(sum);
    	})
    	})
})
})
	$("body").css("opacity","1 !important")
	})
	
// Add an Expense
var sbmtbtn=document.getElementById("sbmt-btn");
sbmtbtn.addEventListener("click", function (){
	$("body").css("opacity","0.6");
	
let gotName=document.getElementById("entr-nm").value;
let gotCost=document.getElementById("entr-cst").value;
let gotDate=new Date();
var d = new Date();
var months = ["January","February","March","April","May","June","July","August","September","October","November","December"];
let gotMonth = months[d.getMonth()];
let gotYear = d.getFullYear();
let gotHours = d.getHours();
let gotMinutes = d.getMinutes();
let gotDay= d.getDate();

db.collection("Accounts")
.doc($(".usrsfld").val().toString())
.collection('intru-money')
.doc()
.set({
    name: gotName,
    cost:gotCost,
	date:gotDate,
	day:gotDay,
	month:gotMonth,
	year:gotYear,
	hour:gotHours,
	minute:gotMinutes
})
.then(function() {
$(".entr-nm").val("");
$(".entr-cst").val("");
$("#expense-list").empty();

		var mnthsslt = $(".mnth_slct").children("option:selected").text();
db.collection('Accounts')
.doc($(".usrsfld").val().toString())
.collection('intru-money')
.orderBy('date')
.get()
.then(function(querySnapshot) {
    querySnapshot.forEach(function(doc) {
        // doc.data() is never undefined for query doc snapshots
		renderExpense(doc);
		$(".li_frm").hide();
		
		$("span:contains('" + mnthsslt + "')").parent().show();
		var sum = 0;
    	$('.money_class:not(:hidden)').each(function() {
	    sum += +$(this).text()||0;
    	});
	    $(".sum_exp").text(sum);
	    
	    $("body").css("opacity","1");
})
})
})
})

}




