// Create Element and render expenses
const expnsList=document.getElementById('expense-list');
function renderExpense(doc){
let expnsList=document.getElementById('expense-list');
let li= document.createElement('LI');
let name=document.createElement('SPAN');
name.setAttribute("class", "name_class");
let money=document.createElement('SPAN');
money.setAttribute("class","money_class");
let dates=document.createElement('SPAN');
dates.setAttribute("class","dates_class");
let cross= document.createElement('div');
cross.setAttribute("class","cross_class");

li.setAttribute('data-id', doc.id);
name.textContent=doc.data().name;
money.textContent=doc.data().cost;
let date = doc.data().date;
dates.textContent=date.toDate();
cross.textContent='x';

expnsList.appendChild(li);
li.appendChild(name);
li.appendChild(money);
li.appendChild(dates);
li.appendChild(cross);

//Delete a document
cross.addEventListener('click',(e)=>{
e.stopPropagation();
let id=e.target.parentElement.getAttribute('data-id');
db.collection('Accounts')
.doc('ozoz2iMWW99JZP2C7Uxd')
.collection('Expense')
.doc(id)
.delete()
.then(function() {
alert("Successfully Deleted Data!");
window.location.href="expenses.html";
})
})

};


//Add data via form
let btn=document.getElementById("sbmt-btn");

function addExpns(){
let gotName=document.getElementById("entr-nm").value;
let gotCost=document.getElementById("entr-cst").value;
let gotDate=new Date();

db.collection("Accounts")
.doc('ozoz2iMWW99JZP2C7Uxd')
.collection('Expense')
.doc()
.set({
    name: gotName,
    cost:gotCost,
date:gotDate
})
.then(function() {
alert("Successfully Written Data!");
window.location.href="expenses.html";
})
}

//Listen for Realtime Updates

db.collection('Expenses').orderBy('date')
.onSnapshot(function(snapshot){
snapshot.docChanges().forEach(function(change){
if(change.type === 'added'){
renderExpense(change.doc);
}

else if(change.type==='removed'){
let expnsList=document.getElementById('expense-list');
let li=expnsList.querySelector('[data-id='+change.doc.id+']');
expnsList.removeChild(li);
}
})
});

//Display data in page

db.collection('Accounts')
.doc('ozoz2iMWW99JZP2C7Uxd')
.collection('Expense')
.orderBy('date')
.get()
.then(function(querySnapshot) {
    querySnapshot.forEach(function(doc) {
        // doc.data() is never undefined for query doc snapshots

renderExpense(doc);
});
});



$(document).ready(function(){
$(".frm-cntnr").hide();

$(".pls-icn").click(function(){
$(".frm-cntnr").toggle();
});
});
